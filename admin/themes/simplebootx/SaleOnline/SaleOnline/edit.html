<!DOCTYPE html>

<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->

<!--[if !IE]><!--> <html lang="en" class="no-js"> <!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

	<meta charset="utf-8" />

	<title>Metronic | Admin Dashboard Template</title>

	<meta content="width=device-width, initial-scale=1.0" name="viewport" />

	<meta content="" name="description" />

	<meta content="" name="author" />

	<!-- 引入顶部样式文件 -->
	<admintpl file="head_css" />
	<script src="__PUBLIC__/js/jquery.js"></script>
    <script src="__PUBLIC__/js/wind.js"></script>
    <!-- <script src="__PUBLIC__/simpleboot/bootstrap/js/bootstrap.min.js"></script> -->
	<script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script>
    <script>
    	$(function(){
    		$("[data-toggle='tooltip']").tooltip();
    	});
    </script>
	<style>
		label{
			display: inline-block;
		}
		.controls input[type="radio"] {margin-left:0px;}
		* {margin:0;padding:0;}

		.dropdown2 {display:inline-block;width:220px;height:20px;
			position:relative;margin-left:20px;}
		.dropdown2 .editor {display:block;border:0;padding:0;width:100%;box-shadow: inset 1px 2px 3px #ddd;height:inherit;}
		.dropdown2 .trigger {position:absolute;top:0;right:0;padding:3px;}
		.dropdown2 ul {display:none;width:98%;height:140px;padding:2px;position:absolute;top:100%;background-color:#FFF;border:1px solid #DDD;border-radius: 0 0 5px 5px;overflow-y:auto;overflow-x:hidden;margin:0px;z-index: 10;margin-top:8px;}
		.dropdown2 ul li {height:20px;display:block;font-size:12px;overflow:hidden;cursor:pointer;}
		.dropdown2 ul li .hot {color: red;}
		.dropdown2 ul li:hover {background-color: #EEE;}
		.dropdown2 ul .search {display:block;border-bottom: 1px solid #808080;}
		.dropdown2 ul .search:hover{background-color:#FFF;}
		.dropdown2 ul .search input {padding:2px;width:100%;border:0;font-size:14px;background:none;}
	</style>
</head>

<!-- END HEAD -->

<!-- BEGIN BODY -->

<body class="page-header-fixed">

	<!-- 引入顶部开始 -->

	<admintpl file="head" />

	<!-- 引入顶部结束 -->

	<!-- BEGIN CONTAINER -->

	<div class="page-container">

		<!-- 引入左侧边栏开始 -->

		<admintpl file="lefter" />

		<!-- 引入左侧边栏结束 -->

		<!-- BEGIN PAGE -->

		<div class="page-content">

			<!-- BEGIN PAGE CONTAINER-->

			<div class="container-fluid">

				<admintpl file="style_bn" />

				<!-- END PAGE HEADER-->

				<!-- 右边主页面开始 -->
				<h2>修改商品</h2>
				<form action="{:U('SaleOnline/update')}"  method="post" enctype="multipart/form-data">
					<input name="goods_id" type="hidden" value="{$data.id}" >
					<table class="table table-hover table-bordered table-list">
						<tr>
							<td>
								*商品名:
							</td>
							<td>
								<input name="goods_name" type="text" class="" value="{$data.goods_name}" required>
							</td>
						</tr>
						<tr>
							<td>
								限招人数：
							</td>
							<td>
								<input name="limit_num" type="text" class="limit_num" value="{$data.limit_num}">
							</td>
						</tr>
						<tr>
							<td>
								优惠金额：
							</td>
							<td>
								<input name="dct_price" type="text" class="dct_price" value="{$data.dct_price}">
							</td>
						</tr>
						<tr>
							<td>
								*售价：
							</td>
							<td>
								<input name="sale_price" type="text" class="sale_price" value="{$data.sale_price}">
							</td>
						</tr>
						<tr>
							<td>
								*班级:
							</td>
							<td>
								<select name="class_id" id="class_id">
									<option value="">--请选择--</option>
									<foreach name="classes" item="class">
										<option value="{$class.id}" id-value="{$class.class_no}" name-value="{$class.class_name}"
										<if condition="$data.class_id eq $class.id ">selected="selected"</if>
										>
										{$class.class_name}
										</option>
									</foreach>
								</select>
								<input name="class_no" type="hidden" id="class_no"  value="{$data.class_no}">
								<input name="class_name" type="hidden" id="class_name" value="{$data.class_name}">
							</td>
						</tr>
						<tr>
							<td>
								*班级封面：
							</td>
							<td>
								<img src="http://ooylo9ron.bkt.clouddn.com/{$data.goods_cover}" width="100px" height="100px">
								<input name="goods_cover" type="hidden"  value="{$data.goods_cover}">
								<input type="file" name="filess" id="filess" autocomplete="off"/>
							</td>
						</tr>
						<tr>
							<td>
								开放试看功能：
							</td>
							<td>

								<label><input name="try_look" type="radio" value="1" <if condition="$data.try_look eq 1 ">checked='checked'</if> >不试看</label>
								<label><input name="try_look" type="radio" value="2" <if condition="$data.try_look eq 2 ">checked='checked'</if> > 试看</label>

							</td>
						</tr>
						<tr>
							<td>
								*班级详情：
							</td>
							<td>
								<script type="text/plain" id="content" name="goods_info" value="">{$data.goods_info}</script>
							</td>
						</tr>
					</table>

					<div class="frombtn">
						<input type="submit" value='提交' class="btn btn-primary">
					</div>
				</form>


				<!-- 右边主页面结束 -->
				<script src="__PUBLIC__/js/common.js"></script>
				<script type="text/javascript" src="__PUBLIC__/js/datePicker/datePicker.js?v="></script>
				<script type="text/javascript">
                    //编辑器路径定义
                    var editorURL = GV.WEB_ROOT;
				</script>
				<script type="text/javascript" src="__PUBLIC__/js/ueditor/ueditor.config.js"></script>
				<script type="text/javascript" src="__PUBLIC__/js/ueditor/ueditor.all.min.js"></script>
				<script type="text/javascript">
                    $(function() {

                        //点击给input赋值
                        $("#class_id").delegate("option", "click", function(){
                            var class_name = $(this).attr('name-value');
                            var class_no   = $(this).attr('id-value');
                            $('#class_name').val(class_name);
                            $('#class_no').val(class_no);
                        });


                        //setInterval(function(){public_lock_renewal();}, 10000);
                        $(".js-ajax-close-btn").on('click', function(e) {
                            e.preventDefault();
                            Wind.use("artDialog", function() {
                                art.dialog({
                                    id : "question",
                                    icon : "question",
                                    fixed : true,
                                    lock : true,
                                    background : "#CCCCCC",
                                    opacity : 0,
                                    content : "您确定需要关闭当前页面嘛？",
                                    ok : function() {
                                        setCookie("refersh_time", 1);
                                        window.close();
                                        return true;
                                    }
                                });
                            });
                        });
                        /////---------------------
                        Wind.use('validate', 'ajaxForm', 'artDialog', function() {
                            //javascript

                            //编辑器
                            editorcontent = new baidu.editor.ui.Editor();
                            editorcontent.render('content');
                            try {
                                editorcontent.sync();
                            } catch (err) {
                            }
                            //增加编辑器验证规则
                            jQuery.validator.addMethod('editorcontent', function() {
                                try {
                                    editorcontent.sync();
                                } catch (err) {
                                }
                                ;
                                return editorcontent.hasContents();
                            });
                            var form = $('form.js-ajax-forms');
                            //ie处理placeholder提交问题
                            if ($.browser && $.browser.msie) {
                                form.find('[placeholder]').each(function() {
                                    var input = $(this);
                                    if (input.val() == input.attr('placeholder')) {
                                        input.val('');
                                    }
                                });
                            }
                            //表单验证开始
                            form.validate({
                                //是否在获取焦点时验证
                                onfocusout : false,
                                //是否在敲击键盘时验证
                                onkeyup : false,
                                //当鼠标掉级时验证
                                onclick : false,
                                //验证错误
                                showErrors : function(errorMap, errorArr) {
                                    //errorMap {'name':'错误信息'}
                                    //errorArr [{'message':'错误信息',element:({})}]
                                    try {
                                        $(errorArr[0].element).focus();
                                        art.dialog({
                                            id : 'error',
                                            icon : 'error',
                                            lock : true,
                                            fixed : true,
                                            background : "#CCCCCC",
                                            opacity : 0,
                                            content : errorArr[0].message,
                                            cancelVal : '确定',
                                            cancel : function() {
                                                $(errorArr[0].element).focus();
                                            }
                                        });
                                    } catch (err) {
                                    }
                                },
                                //验证规则
                                rules : {
                                    'goods_info' : {
                                        editorcontent : true
                                    }
                                },
                                //验证未通过提示消息
                                messages : {
                                    'goods_info' : {
                                        editorcontent : '内容不能为空'
                                    }
                                },
                                //给未通过验证的元素加效果,闪烁等
                                highlight : false,
                                //是否在获取焦点时验证
                                onfocusout : false,
                                //验证通过，提交表单
                                submitHandler : function(forms) {
                                    $(forms).ajaxSubmit({
                                        url : form.attr('action'), //按钮上是否自定义提交地址(多按钮情况)
                                        dataType : 'json',
                                        beforeSubmit : function(arr, $form, options) {

                                        },
                                        success : function(data, statusText, xhr, $form) {
                                            if (data.status) {
                                                setCookie("refersh_time", 1);
                                                //添加成功
                                                Wind.use("artDialog", function() {
                                                    art.dialog({
                                                        id : "succeed",
                                                        icon : "succeed",
                                                        fixed : true,
                                                        lock : true,
                                                        background : "#CCCCCC",
                                                        opacity : 0,
                                                        content : data.info,
                                                        button : [ {
                                                            name : '继续编辑？',
                                                            callback : function() {
                                                                //reloadPage(window);
                                                                return true;
                                                            },
                                                            focus : true
                                                        }, {
                                                            name : '返回列表页',
                                                            callback : function() {
                                                                location = "{:U('AdminPost/index')}";
                                                                return true;
                                                            }
                                                        } ]
                                                    });
                                                });
                                            } else {
                                                artdialog_alert(data.info);
                                            }
                                        }
                                    });
                                }
                            });
                        });
                        ////-------------------------

                    });


				</script>

			</div>
			<!-- END PAGE CONTAINER-->

		</div>

		<!-- END PAGE -->

	</div>
<!-- 加载的右边框架 -->


	<!-- END CONTAINER -->

	<!-- 引入底部开始 -->

	<admintpl file="footer" />

	<!-- 引入底部结束 -->

	<admintpl file="footer_js" />

</body>

<!-- END BODY -->

</html>