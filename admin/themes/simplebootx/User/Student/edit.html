<!DOCTYPE html>

<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->

<!--[if !IE]><!--> <html lang="en" class="no-js"> <!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

	<meta charset="utf-8" />

	<title>Metronic | Admin Dashboard Template</title>

	<meta content="width=device-width, initial-scale=1.0" name="viewport" />

	<meta content="" name="description" />

	<meta content="" name="author" />

	<!-- 引入顶部样式文件 -->

	<admintpl file="head_css" />
	<script src="__PUBLIC__/js/jquery.js"></script>
	<script src="__PUBLIC__/js/wind.js"></script>
	<style>
		.expander{margin-left: -20px;}
		.controls input[type="radio"] {margin-left:0px;}

		.dropdown2 {display:inline-block;width:220px;height:20px;
			position:relative;margin-left:20px;}
		.dropdown2 .editor {display:block;border:0;padding:0;width:100%;box-shadow: inset 1px 2px 3px #ddd;height:inherit;}
		.dropdown2 .trigger {position:absolute;top:0;right:0;padding:3px;}
		.dropdown2 ul {display:none;width:98%;height:140px;padding:2px;position:absolute;top:100%;background-color:#FFF;border:1px solid #DDD;border-radius: 0 0 5px 5px;overflow-y:auto;overflow-x:hidden;margin:0px;z-index: 10;margin-top:8px;}
		.dropdown2 ul li {height:20px;display:block;font-size:12px;overflow:hidden;cursor:pointer;}
		.dropdown2 ul li .hot {color: red;}
		.dropdown2 ul li:hover {background-color: #EEE;}
		.dropdown2 ul .search {display:block;backgound: url(imgs/search.gif) no-repeat scroll center right;border-bottom: 1px solid #808080;}
		.dropdown2 ul .search:hover{background-color:#FFF;}
		.dropdown2 ul .search input {padding:2px;width:100%;border:0;font-size:14px;background:none;}


		.dropdown3 {display:inline-block;width:220px;height:20px;
			position:relative;margin-left:20px;}
		.dropdown3 .editor {display:block;border:0;padding:0;width:100%;box-shadow: inset 1px 2px 3px #ddd;height:inherit;}
		.dropdown3 .trigger {position:absolute;top:0;right:0;padding:3px;}
		.dropdown3 ul {display:none;width:98%;height:140px;padding:2px;position:absolute;top:100%;background-color:#FFF;border:1px solid #DDD;border-radius: 0 0 5px 5px;overflow-y:auto;overflow-x:hidden;margin:0px;z-index: 10;margin-top:8px;}
		.dropdown3 ul li {height:20px;display:block;font-size:12px;overflow:hidden;cursor:pointer;}
		.dropdown3 ul li .hot {color: red;}
		.dropdown3 ul li:hover {background-color: #EEE;}
		.dropdown3 ul .search {display:block;backgound: url(imgs/search.gif) no-repeat scroll center right;border-bottom: 1px solid #808080;}
		.dropdown3 ul .search:hover{background-color:#FFF;}
		.dropdown3 ul .search input {padding:2px;width:100%;border:0;font-size:14px;background:none;}
	</style>

</head>

<!-- END HEAD -->

<!-- BEGIN BODY -->

<body class="page-header-fixed">

	<!-- 引入顶部开始 -->

	<admintpl file="head" />

	<!-- 引入顶部结束 -->

	<!-- BEGIN CONTAINER -->

	<div class="page-container">

		<!-- 引入左侧边栏开始 -->

		<admintpl file="lefter" />

		<!-- 引入左侧边栏结束 -->

		<!-- BEGIN PAGE -->

		<div class="page-content">

			<!-- BEGIN PAGE CONTAINER-->

			<div class="container-fluid">

				<admintpl file="style_bn" />

				<!-- END PAGE HEADER-->

				<!-- 右边主页面开始 -->
				<div class="wrap js-check-wrap">
					<form method="post" class="form-horizontal js-ajax-forms" action="{:U('Student/edit_post')}">
						<table>
							<tr>
								<td width="500" height="40">
								<input type="hidden" name="id" value="{$data.id}">
									<div class="control-group">
										<label class="control-label">*手机号（账号）:</label>
										<div class="controls">
											<input type="text" name="user_login" id="user_login" value="{$data.user_login}"/>
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*姓名:</label>
										<div class="controls">
											<input type="text" name="user_name" id="user_name" value="{$data.user_name}">
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*分校:</label>
										<div class="controls">
											<select name="zone_id" id="zone_id" style="width: 120px;">
												<option value='{$sarr.zone_id}'>{$sarr.zone_name}</option>
												<foreach name="school" item="vo">
												<option value='{$vo.id}' name-value="{$vo.sz_name}" serial-val="{$vo.serial}">{$vo.sz_name}</option>
												</foreach>
											</select> &nbsp;&nbsp;
											<input type="hidden" name="zone_name" id="zone_name" value="{$sarr.zone_name}"/>
											<!-- <input type="hidden" name="serial" id="serial"/> -->
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*校区:</label>
										<div class="controls">
											<select name="sub_zone_id" id="sub_zone_id" style="width: 120px;">
												<option value='{$sarr.sub_zone_id}'>{$sarr.sub_zone_name}</option>
											</select> &nbsp;&nbsp;&nbsp;&nbsp;
											<input type="hidden" name="sub_zone_name" id="sub_zone_name" value="{$sarr.sub_zone_name}"/>
											<!-- <input type="hidden" name="sub_serial" id="sub_serial"/> -->
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*专属服务老师:</label>
										<div class="controls">
											<input type="text" name="tch_name" value="{$sarr.tch_name}">
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*入学日期:</label>
										<div class="controls">
											<input type="text" name="enter_time" class="js-date" value="{$sarr.enter_time}" style="width: 120px;" autocomplete="off" required>
											<span class="form-required">*</span>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">客户来源:</label>
										<div class="controls">
											<select name="stu_source" id="stu_source" style="width: 150px;">
												<option value='1'>线上提交表单咨询</option>
												<option value='2'>线上及时通讯咨询</option>
												<option value='3'>电话咨询</option>
												<option value='4'>宣讲会咨询</option>
												<option value='5'>店面咨询</option>
												<option value='6'>其它</option>
											</select>
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">类型:</label>
										<div class="controls">
											<input type="radio" name="stu_type" value="1" <if condition="$sarr.stu_type eq 1">checked</if>>应届生
											<input type="radio" name="stu_type" value="2" <if condition="$sarr.stu_type eq 2">checked</if>>非应届生
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">性别:</label>
										<div class="controls">
											<select name="sex" style="width: 50px;">
												<option value="1" <if condition="$data.sex eq 1">checked</if>>男</option>
												<option value="2" <if condition="$data.sex eq 2">checked</if>>女</option>
											</select>
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">出生年月:</label>
										<div class="controls">
											<input type="text" name="birthday" class="js-date" value="{$data.birthday}" style="width: 120px;" autocomplete="off">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">所在地区:</label>
										<div class="controls">
											<select id="cmbProvince" name="cmbProvince" style="width:100px;" >{$data.province}</select>
					                        <select id="cmbCity" name="cmbCity" style="width:100px;">{$data.city}</select>  
					                        <select id="cmbArea" name="cmbArea" style="width:100px;">{$data.county}</select>
										</div>
									</div>
								</td>
								<td width="500" height="40"></td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">本科学校:</label>
										<div class="controls">
											<input type="text" name="college" id="college" value="{$sarr.college}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">本科院系:</label>
										<div class="controls">
											<input type="text" name="college_dept" value="{$sarr.college_dept}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">本科专业:</label>
										<div class="controls">
											<input type="text" name="college_major" id="college_major" value="{$sarr.college_major}">
										</div>
									</div>
								</td>
								<td width="500" height="40"></td>
							</tr>
							<!-- <tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">目标院校:</label>
										<div class="controls">
											<input type="text" name="dst_school" id="dst_school">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">目标院系:</label>
										<div class="controls">
											<input type="text" name="dst_dept" id="dst_dept">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">目标专业:</label>
										<div class="controls">
											<input type="text" name="dst_major" id="dst_major">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">目标方向:</label>
										<div class="controls">
											<input type="text" name="dst_research" id="dst_research">
										</div>
									</div>
								</td>
							</tr> -->
							<tr>
								<td>
									<label class="control-label">所属院校:</label>
									<div class="dropdown2" id="dropdown_sel">  <!-- 模拟 select 的标记， -->
										<input class="editor2" type="text" name="school_name" disabled="disabled" value="{$sarr.dst_school}"/> <!-- 显示当前值的输入框 -->
										<input class="school_id" type="hidden" name="school_id" id="school_id" value="{$sarr.school_id}"/><!-- 学校id -->
										<input class="school_name" type="hidden" name="school_name" id="school_name" value="{$sarr.dst_school}"/><!-- 学校name -->
										<input class="trigger"  type="button" value="↓" /> <!-- 用于显示下拉列表的按钮 -->
										<ul>   <!-- 列表菜单 -->
											<li class="search"><input type="text"/></li>   <!-- 过滤输入的列表， -->
											<!-- 添加数据的时候，都添加在这个地方 -->
											<foreach name="sch" item="vo">
												<li data-value="{$vo.school_name}" id-value="{$vo.id}" code-value="{$vo.code}" area-value="{$vo.area_id}">{$vo.school_name}</li>
											</foreach>
										</ul>
									</div>
								</td>
								<td>
									<label class="control-label">所属院系:</label>
									<div class="controls">
										<select name="dept_id" id="dept_id">
											<option value="{$sarr.dept_id}">{$sarr.dst_dept}</option>
										</select>
										<input type="hidden" name="dept_name" id="dept_name" value="{$sarr.dst_dept}"><!-- 院系名称 -->
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<label class="control-label">所属专业:</label>
									<div class="controls">
										<select name="major_id" id="major_id">
											<option value="{$sarr.major_id}">{$sarr.dst_major}</option>
										</select>
										<input type="hidden" name="major_name" id="major_name" value="{$sarr.dst_major}"><!-- 专业名称 -->
										<span class="form-required">*</span>
									</div>
								</td>
								<td>
									<label class="control-label">所属方向:</label>
									<div class="dropdown3" id="dropdown_sel">  <!-- 模拟 select 的标记， -->
										<input class="editor3" type="text" name="research_name" disabled="disabled" value="{$sarr.dst_research}"/> <!-- 显示当前值的输入框 -->
										<input class="research_id" type="hidden" name="research_id" id="research_id" value="{$sarr.research_id}"/><!-- 学校id -->
										<input class="research_name" type="hidden" name="research_name" id="research_name" value="{$sarr.dst_research}"/><!-- 学校name -->
										<input class="trigger"  type="button" value="↓" /> <!-- 用于显示下拉列表的按钮 -->
										<ul id="research">   <!-- 列表菜单 -->

											   <!-- 过滤输入的列表， -->
											<!-- 添加数据的时候，都添加在这个地方 -->
											
										</ul>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">政治目标成绩:</label>
										<div class="controls">
											<input type="text" name="politics_score" value="{$sarr.politics_score}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">外语目标成绩:</label>
										<div class="controls">
											<input type="text" name="lang_score" value="{$sarr.lang_score}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">业务一目标成绩:</label>
										<div class="controls">
											<input type="text" name="bus_one_score" value="{$sarr.bus_one_score}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">业务二目标成绩:</label>
										<div class="controls">
											<input type="text" name="bus_two_score" value="{$sarr.bus_two_score}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">政治目标排名:</label>
										<div class="controls">
											<input type="text" name="politics_rank" value="{$sarr.politics_rank}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">外语目标排名:</label>
										<div class="controls">
											<input type="text" name="lang_rank" value="{$sarr.lang_rank}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">业务一目标排名（数学必填）:</label>
										<div class="controls">
											<input type="text" name="bus_one_rank" value="{$sarr.bus_one_rank}">
										</div>
									</div>
								</td>
								<td width="500" height="40"></td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">飞跃意向:</label>
										<div class="controls">
											<input type="text" name="leap_intention" id="leap_intention" value="{$sarr.leap_intention}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">薄弱学科:</label>
										<div class="controls">
											<input type="text" name="weak_subject" id="weak_subject" value="{$sarr.weak_subject}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">*家长电话:</label>
										<div class="controls">
											<input type="text" name="parent_phone" value="{$sarr.parent_phone}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">微信号:</label>
										<div class="controls">
											<input type="text" name="stu_wechat" value="{$sarr.stu_wechat}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">QQ号:</label>
										<div class="controls">
											<input type="text" name="stu_qq" value="{$sarr.stu_qq}">
										</div>
									</div>
								</td>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">邮箱:</label>
										<div class="controls">
											<input type="text" name="stu_email" value="{$sarr.stu_email}">
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td width="500" height="40">
									<div class="control-group">
										<label class="control-label">备注:</label>
										<div class="controls">
											<textarea name="remark" rows="5">{$sarr.remark}</textarea>
										</div>
									</div>
								</td>
							</tr>
						</table>
						<div class="form-actions">
							<button type="submit" class="btn btn-primary js-ajax-submit">提交</button>
							<a class="btn" href="javascript:history.back(-1);">{:L('BACK')}</a>
						</div>
					</form>
				</div>
				<!-- 右边主页面结束 -->
				<script src="__PUBLIC__/js/common.js"></script>
				<script type="text/javascript" src="__PUBLIC__/js/datePicker/datePicker.js?v="></script>
				<script src="__PUBLIC__/js/jquery.validate.min.js"></script>
				<script src="__PUBLIC__/js/datePicker/datePicker.js"></script>
				<script src="__PUBLIC__/js/region.js"></script>
				<script type="text/javascript">
				addressInit('cmbProvince', 'cmbCity', 'cmbArea');

				$("#user_login").blur(function(){
					var value = $(this).attr('value'); // 获取校区的id值
					
					var url = '/index.php?g=User&m=Student&a=varification&value='+value;
					$.ajax({
				        url:url,
				        type:'GET',
				        dataType:'json',
				        data:{},
				        success:function(msg){
				          	if(msg.code == 1){
				          		alert("该用户已经是学员，请重新添加");
				          	}
				          	if(msg.code == 2){
				          		console.log(msg.data);
				          		it = msg.data;
				          		alert("该用户是潜在会员");
				          		$("#user_name").attr("value",it.user_name);
				          		$("#college").attr("value",it.from);  // 来源学校
				          		$("#college_major").attr("value",it.study_major);  // 所学专业
				          		$("#dst_school").attr("value",it.dst_school);  // 目标院校
				          		$("#dst_dept").attr("value",it.dst_dept);  // 目标院系
				          		$("#dst_major").attr("value",it.dst_major);  // 目标专业
				          		$("#dst_research").attr("value",it.dst_rch);  // 目标方向
				          		$("#leap_intention").attr("value",it.purpose);  // 飞跃意向
				          		$("#weak_subject").attr("value",it.weak_subject);  // 薄弱学科
				          	}
                        }
                    });
				}); 


				// 获取分校
				$("#zone_id").delegate("option", "click", function(e){  // 点击校区
					var zone_id = $(this).attr('value'); // 获取校区的id值
					var name    = $(this).attr('name-value'); // 获取校区的id值
					var serial  = $(this).attr('serial-val'); // 获取校区的序号

					$("#zone_name").attr("value",name);
					$("#serial").attr("value",serial);
					$("#zone_sub_id").find("option").remove();

					var url = '/index.php?g=Admin&m=Classnotice&a=getZone&zone_id='+zone_id;
					$.ajax({
				        url:url,
				        type:'GET',
				        dataType:'json',
				        data:{},
				        success:function(msg){
				          var str = "<option value=''>--全部--</option>";
				          $(msg).each(function(i){
				          	var item = msg[i];
				          	str += '<option value="'+item['id']+'" name-value="'+item['sz_name']+'" serial-val="'+item['serial']+'">'+item['sz_name']+'</option>';
				          });
				          $("#sub_zone_id").html(str);
                        }
                    });
				})

				// 获取分校
				$("#sub_zone_id").delegate("option", "click", function(e){  // 点击分校
					var sub_name = $(this).attr('name-value'); // 获取校区的名称
					var serial = $(this).attr('serial-val'); // 获取校区的名称
					$("#sub_zone_name").attr("value",sub_name);
					$("#sub_serial").attr("value",serial);
				})




				$(function(){
						//当列表项被点击时，把列表项的值放在输入框里面，
						$(".dropdown2").delegate("li", "click", function(e){
							var v  = $(this).attr("data-value"),
								drop = $(this).closest(".dropdown2");
							var id = $(this).attr('id-value');
							var name = $(this).attr('data-value');

							$('#school_id').val(id);
							$('#school_name').val(name);

							drop.attr("data-value", v);
							drop.find(".editor2").val(v);
							$(this).parent().hide();
							e.stopPropagation();
							$("#dept_id").find("option").remove();

							var url = '/index.php?g=Admin&m=Research&a=getdept&school_id='+id;
							$.ajax({
						        url:url,
						        type:'GET',
						        dataType:'json',
						        data:{},
						        success:function(msg){
						          var str = "<option value=''>--请选择--</option>";
						          $(msg).each(function(i){
						          	var item = msg[i];
						          	str += '<option value="'+item['id']+'" code-value="'+item['dept_code']+'" name-value="'+item['dept_name']+'">'+item['dept_name']+'</option>';
						          });
						          $("#dept_id").html(str);
		                        }
		                     });
     
						}).delegate(".trigger", "click", function(e){    //当下拉按钮被点击时，显示数据列表
							$(this).closest(".dropdown2").find("ul").show();
							e.stopPropagation();  //阻止冒泡，因为冒泡到 document 的时候，会隐藏列表
						}).delegate(".search input", "click", function(e){
							e.stopPropagation(); 
						}).delegate(".search input", "keyup", function(e){    //当检测到列表中的输入框的时候，启动过滤，不满足的项隐藏
							var v = $.trim(this.value), list = $(this).closest("ul").children("li");
							if(v == "") {    //特殊情况，过滤输入框中没有值的时候迭代所有的列表项并显示它们
								list.each(function(){
									if(this.className.indexOf("search") != -1) {return;}//不考虑过滤输入框所在的列表项
									$(this).text(this.innerText || this.textContent).show();
								});
							} else {
								list.each(function(){   //迭代列表，
									if(this.className.indexOf("search") != -1) {return;}  //不考虑过滤输入框所在的列表项
									var lv = $(this).text();   //列表的文本
									if(lv.indexOf(v) === -1) {   //不匹配过滤文本，就隐藏
										$(this).hide();
									} else {                 //匹配，把匹配的文本替换会含有标记的文本（红色）
										$(this).html(lv.replace(v, '<span class="hot">'+v+'</span>')).show();
									}
								});
							}
							
						});
						
						$(this).click(function(){   //当数据列表在显示时，如果点击了页面其它区域，则隐藏列表
							$(".dropdown ul:visible").hide();   
						});
						$("#dept_id").delegate("option", "click", function(e){  // 点击所属院系
							var dept_id = $(this).attr('value'); // 获取院系的id值
							var dept_name = $(this).attr('name-value'); // 获取院系的name值
							$('#dept_name').val(dept_name);
							$("#major_id").find("option").remove();

							var url = '/index.php?g=Admin&m=Research&a=getmajor&dept_id='+dept_id;
							$.ajax({
						        url:url,
						        type:'GET',
						        dataType:'json',
						        data:{},
						        success:function(msg){
						          var str = "<option value=''>--请选择--</option>";
						          $(msg).each(function(i){
						          	var item = msg[i];
						          	str += '<option value="'+item['major_id']+'" code-value="'+item['major_code']+'" name-value="'+item['major_name']+'">'+item['major_name']+'</option>';
						          });
						          $("#major_id").html(str);
		                        }
		                     });
						})

						$("#major_id").delegate("option", "click", function(e){  // 点击所属专业
							var major_id = $(this).attr('value'); // 获取院系的id值
							var major_name = $(this).attr('name-value'); // 获取院系的name值
							$('#major_name').val(major_name);
							$("#research_id").find("option").remove();

							var url = '/index.php?g=Admin&m=Research&a=getresearch&major_id='+major_id;
							$.ajax({
						        url:url,
						        type:'GET',
						        dataType:'json',
						        data:{},
						        success:function(msg){
						          var str = '<li class="search"><input type="text"/></li>';
						          $(msg).each(function(i){
						          	var item = msg[i];
						          	str += '<li data-value="'+item['rch_name']+'" id-value="'+item['id']+'">'+item['rch_name']+'</li>';
						          });
						          $("#research").html(str);
		                        }
		                     });
						})
					});

					$(function(){
						//当列表项被点击时，把列表项的值放在输入框里面，
						$(".dropdown3").delegate("li", "click", function(e){
							var v  = $(this).attr("data-value"),
								drop = $(this).closest(".dropdown3");
							var id = $(this).attr('id-value');
							var name = $(this).attr('data-value');

							$('#research_id').val(id);
							$('#research_name').val(name);

							drop.attr("data-value", v);
							drop.find(".editor3").val(v);
							$(this).parent().hide();
							e.stopPropagation();
     
						}).delegate(".trigger", "click", function(e){    //当下拉按钮被点击时，显示数据列表
							$(this).closest(".dropdown3").find("ul").show();
							e.stopPropagation();  //阻止冒泡，因为冒泡到 document 的时候，会隐藏列表
						}).delegate(".search input", "click", function(e){
							e.stopPropagation(); 
						}).delegate(".search input", "keyup", function(e){    //当检测到列表中的输入框的时候，启动过滤，不满足的项隐藏
							var v = $.trim(this.value), list = $(this).closest("ul").children("li");
							if(v == "") {    //特殊情况，过滤输入框中没有值的时候迭代所有的列表项并显示它们
								list.each(function(){
									if(this.className.indexOf("search") != -1) {return;}//不考虑过滤输入框所在的列表项
									$(this).text(this.innerText || this.textContent).show();
								});
							} else {
								list.each(function(){   //迭代列表，
									if(this.className.indexOf("search") != -1) {return;}  //不考虑过滤输入框所在的列表项
									var lv = $(this).text();   //列表的文本
									if(lv.indexOf(v) === -1) {   //不匹配过滤文本，就隐藏
										$(this).hide();
									} else {                 //匹配，把匹配的文本替换会含有标记的文本（红色）
										$(this).html(lv.replace(v, '<span class="hot">'+v+'</span>')).show();
									}
								});
							}
							
						});
					});
				</script>
			</div>
			<!-- END PAGE CONTAINER-->
			<script type="text/javascript">
                $(function() {
                    /////---------------------
                    Wind.use('validate', 'ajaxForm', 'artDialog', function() {

                        var form = $('form.js-ajax-forms');
                        //ie处理placeholder提交问题
                        if ($.browser && $.browser.msie) {
                            form.find('[placeholder]').each(function() {
                                var input = $(this);
                                if (input.val() == input.attr('placeholder')) {
                                    input.val('');
                                }
                            });
                        }

                        var formloading = false;
                        //表单验证开始
                        form.validate({
                            //是否在获取焦点时验证
                            onfocusout : false,
                            //是否在敲击键盘时验证
                            onkeyup : false,
                            //当鼠标掉级时验证
                            onclick : false,
                            //验证错误
                            showErrors : function(errorMap, errorArr) {
                                //errorMap {'name':'错误信息'}
                                //errorArr [{'message':'错误信息',element:({})}]
                                try {
                                    $(errorArr[0].element).focus();
                                    art.dialog({
                                        id : 'error',
                                        icon : 'error',
                                        lock : true,
                                        fixed : true,
                                        background : "#CCCCCC",
                                        opacity : 0,
                                        content : errorArr[0].message,
                                        cancelVal : '确定',
                                        cancel : function() {
                                            $(errorArr[0].element).focus();
                                        }
                                    });
                                } catch (err) {
                                }
                            },
                            //验证规则
                            rules : {
                                'user_login' : {
                                    required : 1
                                },
                                'user_name' : {
                                    required : 1
                                },
                                'zone_id' : {
                                    required : 1
                                },
                                'sub_zone_id' : {
                                    required : 1
                                },
                                'tch_name' : {
                                    required : 1
                                },
                                'enter_time' : {
                                    required : 1
                                },
                                'parent_phone' : {
                                    required : 1
                                }
                            },
                            //验证未通过提示消息
                            messages : {
                                'user_login' : {
                                    required : '请输入手机号'
                                },
                                'user_name' : {
                                    required : '请输入姓名'
                                },
                                'zone_id' : {
                                    required : '请输入分校'
                                },
                                'sub_zone_id' : {
                                    required : '请输入校区'
                                },
                                'tch_name' : {
                                    required : '请输入专属服务老师'
                                },
                                'enter_time' : {
                                    required : '请输入入学日期'
                                },
                                'parent_phone' : {
                                    required : '请输入家长电话'
                                }
                            },
                            //给未通过验证的元素加效果,闪烁等
                            highlight : false,
                            //是否在获取焦点时验证
                            onfocusout : false,
                            //验证通过，提交表单
                            submitHandler : function(forms) {
                                if (formloading)
                                    return;
                                $(forms).ajaxSubmit({
                                    url : form.attr('action'), //按钮上是否自定义提交地址(多按钮情况)
                                    dataType : 'json',
                                    beforeSubmit : function(arr, $form, options) {
                                        formloading = true;
                                    },
                                    success : function(data, statusText, xhr, $form) {
                                        formloading = false;
                                        if (data.status) {
                                            setCookie("refersh_time", 1);
                                            //添加成功
                                            Wind.use("artDialog", function() {
                                                art.dialog({
                                                    id : "succeed",
                                                    icon : "succeed",
                                                    fixed : true,
                                                    lock : true,
                                                    background : "#CCCCCC",
                                                    opacity : 0,
                                                    content : data.info,
                                                    button : [ {
                                                        name : '继续编辑？',
                                                        callback : function() {
                                                            reloadPage(window);
                                                            return true;
                                                        },
                                                        focus : true
                                                    }, {
                                                        name : '返回列表页',
                                                        callback : function() {
                                                            location = "{:U('Student/index')}";
                                                            return true;
                                                        }
                                                    } ]
                                                });
                                            });
                                        } else {
                                            artdialog_alert(data.info);
                                        }
                                    }
                                });
                            }
                        });
                    });
                    ////-------------------------
                });
			</script>
		</div>

		<!-- END PAGE -->

	</div>
<!-- 加载的右边框架 -->


	<!-- END CONTAINER -->
			
	<!-- 引入底部开始 -->

	<admintpl file="footer" />

	<!-- 引入底部结束 -->

	<admintpl file="footer_js" />

</body>

<!-- END BODY -->

</html>